# การทดลองที่ ๓ เรื่อง การเขียนโปรแกรมเอ้าพุทสัญญาณดิจิทัล  

## วัตถุประสงค์
1. เพื่อศึกษาการส่งสัญญาณดิจิตอลควบคุมอุปกรณ์ภายนอก
2. เพื่อศึกษาวิธีการรันโปรแกรมในไมโครคอนโทรเลอร์

## อุปกรณ์ที่ใช้
1. ไมโครคอนโทรเลอร์
2. อุปกรณ์ USB to Serial
3. CPU
4. อแดปเตอร์ที่ต่อสายพอร์ท 0(สีขาว) กับ 1 (สีเหลือง)
5. หลอดไฟ LED
6. รีเลย์
7. ขั้วชาร์ต

## ศึกษาข้อมูลเบื้องต้น
1. 03 run example 3 https://youtu.be/CCnN1WJsXQY
2. 03 run relay https://youtu.be/6JnhaUILGuw
3. src code ของโปรแกรมเอ้าพุทสัญญาณดิจิทัล(03_Output-Port) : https://github.com/choompol-boonmee/lab63b/blob/master/examples/03_Output-Port/src/main.cpp

## วิธีการทำการทดลอง
1. นำอแดปเตอร์ที่มีการต่อกับ LED ไปต่อกับอุปกรณ์ USB to Serial 

![image](https://github.com/Nongpim/picture/blob/main/3.1%E0%B9%83%E0%B8%AB%E0%B8%A1%E0%B9%88.jpg)

![image](https://github.com/Nongpim/picture/blob/main/3.2%E0%B9%83%E0%B8%AB%E0%B8%A1%E0%B9%88.jpg)

2. นำตัวไมโครคอนโทรเลอร์ไปต่อเข้ากับพอร์ท แล้วเปิด command prompt เพื่อเขียนโปรแกรมเข้าไปในไมโครคอนโทรเลอร์

![image](https://github.com/Nongpim/picture/blob/main/3.3%E0%B9%83%E0%B8%AB%E0%B8%A1%E0%B9%88.jpg)

3. ดูตัวอย่างโปรแกรมที่จะเขียนในโฟลเดอร์ pattani
    * 3.1 พิมพ์คำสั่ง cd pattani เพื่อที่จะเข้าไปยังโฟลเดอร์
      * 3.1.1 ซึ่งในการทดลองนี้จะให้ใช้โปรแกรมตัวอย่างที่ 3 พิมพ์คำสั่ง cd 03_Output-Port
      * 3.1.2 พิมพ์คำสั่ง vi src/main.cpp จะแสดงโค้ดของโปรแกรม ซึ่งประกอบไปด้วย 2 ส่วน
      * ![image](https://github.com/Nongpim/picture/blob/main/3.0%E0%B9%83%E0%B8%AB%E0%B8%A1%E0%B9%88.png)
  ซึ่ง src code ของโปรแกรมนี้ ได้เซตพอร์ท 0 คือ พอร์ท output และมีคำสั่งวนลูป ทุกๆ 500ms โดยจะนับ cnt ไปเรื่อยๆ โดยเมื่อ cnt เป็นเลขคู่ให้เป็น OFF และเมื่อ cnt เป็นเลขคี่ให้เป็น ON
4. อัปโหลดโปรแกรม 03_Output-Port โดยพิมพ์คำสั่ง pio run -t upload
    * 4.1 ในขณะที่รันเพื่อให้ไมโครคอนโทรเลอร์รับโปรแกรมใหม่เข้าไป เราจะต้องกดปุ่มให้โหลด(ปุ่มสีดำ) แล้วกดปุ่มreset(ปุ่มสีแดง) เมื่อโปรแกรมโหลดเข้าไปในคอมพิวเตอร์ตัวจิ๋วนี้แล้ว
5. เมื่อโปรแกรมโหลดเสร็จแล้วจะขึ้นคำว่า SUCCESS ซึ่งต่อไปเราจะใช้คำสั่ง (pio device monitor) แล้วดูผลลัพธ์ที่แสดงผลใน monitor 
![image](https://github.com/Nongpim/picture/blob/main/3.4%E0%B9%83%E0%B8%AB%E0%B8%A1%E0%B9%88.jpg)
![image](https://github.com/Nongpim/picture/blob/main/3.5%E0%B9%83%E0%B8%AB%E0%B8%A1%E0%B9%88.jpg)
6. สังเกตที่หลอดไฟ LED
    * 6.1 OFF ไฟจะดับ
    * 6.2 ON ไฟจะสว่าง
7. นำตัวไมโครคอนโทรเลอร์ที่เขียนโปรแกรมแล้วมาต่อกับตัวรีเลย์
![image](https://github.com/Nongpim/picture/blob/main/3.6%E0%B9%83%E0%B8%AB%E0%B8%A1%E0%B9%88.jpg)

8. นำตัวรีเลย์มาต่อกับขั้วชาร์ต
![image](https://github.com/Nongpim/picture/blob/main/3.7%E0%B9%83%E0%B8%AB%E0%B8%A1%E0%B9%88.jpg)
## การบันทึกผลการทดลอง
จากใช้คำสั่ง pio device monitor จะทำให้เราทราบว่า
1. ผลลัพธ์จะแสดงผลในหน้าจอ monitor ซึ่งจะเห็นได้ว่า monitor จะแสดงคำสั่ง ON OFF ขึ้นมาทุกๆ 500 ms ตาม src code ที่เราเขียนเข้าไปในโปรแกรม และเมื่อสังเกตที่หลอดไฟ LED ที่พอร์ท 0 หลอดไฟก็จะสว่างหรือดับตามคำสั่ง ON OFF เช่นกัน
![image](https://github.com/Nongpim/picture/blob/main/3.5%E0%B9%83%E0%B8%AB%E0%B8%A1%E0%B9%88.jpg)
2. เมื่อนำตัวไมโครคอนโทรเลอร์ที่ลงโปรแกรมแล้วมาประยุกต์ต่อเข้ากับตัวรีเลย์ จะเห็นว่าเมื่อต่อกับขั้วชาร์ตไปแล้ว ตัวรีเลย์จะมีการเปิดปิดทันที โดยสังเกตจากการได้ยินเสียงหน้าสัมผัสของสวิตซ์ไฟ

## อภิปรายผลการทดลอง
จากการทดลองนี้ จะเห็นได้ว่าเมื่อเราอัปโหลดโปรแกรมเอ้าพุทสัญญาณดิจิทัล(03_Output-Port) เข้าไปในไมโครคอนโทรเลอร์ แล้วใช้คำสั่ง pio device monitor ผลลัพธ์จะแสดงผลในหน้าจอ ซึ่งหน้าจอจะขึ้น ON OFF  ทุกๆ 500 ms และเมื่อสังเกตที่หลอดไฟ LED ที่พอร์ท 0 หลอดไฟก็จะสว่างหรือดับตามคำสั่ง ON OFF เช่นกัน ตาม src code ที่เขียนโปรแกรม และเมื่อเรานำตัวไมโครคอนโทรเลอร์ที่ลงโปรแกรมแล้วมาประยุกต์ต่อเข้ากับตัวรีเลย์ ตัวรีเลย์จะมีการเปิดปิดทันที โดยสังเกตจากการได้ยินเสียงหน้าสัมผัสของสวิตซ์ไฟ ตาม src code ที่เขียนโปรแกรม

## คำถามหลังการทดลอง
1. ทำไมเราต้องใช้อแดปเตอร์ที่พอร์ท 0 ในการต่อเข้ากับหลอดไฟ LED
* ตอบ เพราะไมโครคอนโทรเลอร์ที่ใช้ในการทดลองได้เซตให้พอร์ท 0 เป็น พอร์ทของ output
